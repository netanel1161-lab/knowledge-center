<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ציר זמן: פעולות קדימה</title>
    <!-- טעינת Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- הגדרות קונפיגורציה של Tailwind - שימוש בפונט Inter וצבע ראשי כחול -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-color': '#3b82f6', // הכחול של לוק (Blue 500)
                        'secondary-gray': '#f3f4f6',
                        'dark-text': '#1f2937',
                        'current-marker': '#1d4ed8', // כחול כהה יותר להדגשת "כאן ועכשיו"
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* הגדרת הפונט הראשי */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* סגנון כללי לציר הזמן האנכי */
        .timeline-container {
            position: relative;
        }

        /* קו ציר הזמן האנכי */
        .timeline-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 20px; /* ממורכז בצד ימין עבור RTL */
            width: 4px;
            background-color: #d1d5db;
            height: 100%;
            border-radius: 9999px;
            z-index: 1; /* מוודא שהקו מאחורי הנקודות */
        }

        /* עיצוב נקודת הזמן (העיגול על הקו) */
        .timeline-item-marker {
            position: absolute;
            right: 13px; /* ממורכז על הקו */
            width: 18px;
            height: 18px;
            background-color: #f9fafb;
            border: 4px solid #3b82f6; 
            border-radius: 50%;
            z-index: 10;
        }

        /* הגדרת גובה מקסימלי עבור צמצום המשימות */
        .tasks-container {
            max-height: 9rem; /* 144px, כגובה של שתי משימות בערך */
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }

        .tasks-container.expanded {
            max-height: 2000px; /* גובה גדול מספיק כדי להציג את כל המשימות */
        }
        
        /* יישור כרטיס המשימה (משמאל לקו) */
        .timeline-content {
            margin-right: 40px;
            z-index: 5; /* מוודא שהתוכן מעל הקו */
        }
        
        /* ---------------------------------- */
        /* סגנון לציר הדרך העליון (A-B-C) - משופר */
        /* ---------------------------------- */
        .roadmap-dot {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .roadmap-container {
            position: relative;
            padding-top: 20px; /* מקום לנקודות הציון */
        }

        .roadmap-container::before {
            content: '';
            position: absolute;
            top: 30px; /* ממורכז אנכית עם הנקודות */
            left: 5%; 
            right: 5%;
            height: 6px;
            background-color: #d1d5db;
            border-radius: 9999px;
            z-index: 1;
        }

        .roadmap-dot-inner {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #d1d5db;
            border: 4px solid #ffffff;
            transition: all 0.3s ease-in-out;
            position: relative;
            z-index: 5;
            box-shadow: 0 0 0 2px #d1d5db;
        }

        /* עיצוב הנקודה הנוכחית */
        .roadmap-dot.current .roadmap-dot-inner {
            width: 30px;
            height: 30px;
            background-color: #1d4ed8; /* כחול כהה יותר - current-marker */
            border: 4px solid #93c5fd; /* טבעת כחולה בהירה */
            box-shadow: 0 0 0 4px #bfdbfe; /* צל רחב יותר */
        }
        
        /* סמנים לשיפור הנגישות והצבעוניות בהתאם לאדם */
        .person-marker-eliran { background-color: #2563eb; } 
        .person-marker-aviram { background-color: #f59e0b; }
        .person-marker-alex { background-color: #10b981; }
        .person-marker-david { background-color: #ef4444; }
        .person-marker-vered { background-color: #a855f7; }
        .person-marker-netanel { background-color: #06b6d4; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark-text min-h-screen pb-16">

    <!-- כותרת וסינון -->
    <header class="sticky top-0 bg-white shadow-md z-20 p-4 border-b border-gray-100">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-extrabold text-primary-color mb-4 md:mb-0">
                ציר זמן: פעולות קדימה
            </h1>
            
            <!-- בקרת סינון -->
            <div class="flex items-center space-x-2 space-x-reverse">
                <label for="person-filter" class="text-lg font-medium whitespace-nowrap">סינון לפי אדם:</label>
                <select id="person-filter" 
                        class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-primary-color focus:border-primary-color text-gray-700 transition duration-150 ease-in-out">
                    <!-- האפשרויות יטענו ע"י JavaScript -->
                </select>
            </div>
        </div>
    </header>

    <!-- ציר הדרך הכללי (A-B-C) - משופר -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-10 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
        <h2 class="text-2xl font-bold text-dark-text mb-8 border-b pb-2">מפת דרכים כללית (High-Level Roadmap)</h2>
        <div id="roadmap-abc" class="flex justify-between items-start text-center roadmap-container">
            
            <!-- נקודה A: חודש מאי (עבר) -->
            <div class="flex-1 px-2 roadmap-dot">
                <div class="roadmap-dot-inner bg-primary-color"></div>
                <p class="mt-4 text-sm font-semibold text-primary-color">נקודה A</p>
                <p class="text-xs text-gray-600 font-medium">מאי</p>
                <p class="text-sm mt-1 text-gray-800">פיתוח טכנולוגיה ולוגיסטי</p>
            </div>
            
            <!-- נקודה B: חודש אוגוסט (עבר) -->
            <div class="flex-1 px-2 roadmap-dot">
                <div class="roadmap-dot-inner bg-primary-color"></div>
                <p class="mt-4 text-sm font-semibold text-primary-color">נקודה B</p>
                <p class="text-xs text-gray-600 font-medium">אוגוסט</p>
                <p class="text-sm mt-1 text-gray-800">בדיקת כלים בשטח והתנגדויות ראשונות</p>
            </div>
            
            <!-- נקודה C: חודש דצמבר (עתיד) - נניח שאנחנו בנובמבר ולכן זה היעד הקרוב -->
            <div class="flex-1 px-2 roadmap-dot current">
                <div class="roadmap-dot-inner"></div>
                <p class="mt-4 text-sm font-semibold text-current-marker">נקודה C</p>
                <p class="text-xs text-gray-600 font-medium">דצמבר</p>
                <p class="text-sm mt-1 text-gray-800 font-bold">יציאה לשוק והטמעת המערכות</p>
            </div>
        </div>
    </section>

    <!-- תוכן עיקרי - ציר הזמן האנכי -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-10">
        <h2 class="text-2xl font-bold text-dark-text mb-6">משימות לפי חודש ואדם</h2>
        <div id="timeline-output" class="timeline-container mt-8">
            <!-- ציר הזמן ירונדר לכאן -->
        </div>
        
        <!-- הודעת אין נתונים -->
        <div id="no-data-message" class="hidden text-center p-8 mt-12 bg-white rounded-xl shadow-lg border border-gray-200">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="mt-2 text-xl font-semibold text-gray-900">אין משימות להצגה</h3>
            <p class="mt-1 text-gray-500">נראה שאין משימות לאדם הנבחר בחודשים הקרובים.</p>
        </div>
    </main>

    <script>
        const people = ['אלירן', 'אבירם', 'אלכס', 'דוד', 'ורד', 'נתנאל'];
        const INITIAL_TASKS_DISPLAY = 2; // מספר המשימות שיוצגו בהתחלה
        
        // נתונים מדומים לציר הזמן, כולל שדה 'link' אופציונלי
        const timelineData = [
            // --- נובמבר 2025 ---
            { month: 'נובמבר 2025', person: 'אלירן', task: 'הגדרת דרישות מפורטות (Spec) לפיצ\'ר הדיווח החדש.', status: 'מתוכנן', link: 'https://docs.google.com/document/d/spec_report' },
            { month: 'נובמבר 2025', person: 'אבירם', task: 'עיצוב ממשק משתמש (UI/UX) ללוח הבקרה הראשי.', status: 'בעבודה', link: 'https://www.figma.com/file/dashboard_design' },
            { month: 'נובמבר 2025', person: 'אלכס', task: 'הקמת סביבת פיתוח ובדיקות חדשה ב-Cloud.', status: 'הושלם' },
            { month: 'נובמבר 2025', person: 'דוד', task: 'כתיבת מסמך ארכיטקטורה עבור שירותי התשלום.', status: 'מתוכנן' },

            // --- דצמבר 2025 ---
            { month: 'דצמבר 2025', person: 'ורד', task: 'הכנת תכנית תוכן וקופירייטינג לקמפיין השקה.', status: 'בעבודה', link: 'https://airtable.com/app/content_plan' },
            { month: 'דצמבר 2025', person: 'נתנאל', task: 'אופטימיזציה של שאילתות מסד הנתונים הראשיות.', status: 'מתוכנן' },
            { month: 'דצמבר 2025', person: 'אלירן', task: 'סקירת קוד עבור מודול הרשאות (Roles & Permissions).', status: 'הושלם' },
            { month: 'דצמבר 2025', person: 'אלכס', task: 'הטמעת כלי ניטור ודיווח שגיאות.', status: 'מתוכנן' },
            
            // --- ינואר 2026 ---
            { month: 'ינואר 2026', person: 'דוד', task: 'פיתוח מודול ייצוא נתונים לפורמטים שונים (PDF, CSV).', status: 'מתוכנן' },
            { month: 'ינואר 2026', person: 'אבירם', task: 'בדיקות שמישות ואיסוף משוב ממשתמשים מוקדמים.', status: 'מתוכנן' },
            { month: 'ינואר 2026', person: 'ורד', task: 'בניית דפי נחיתה והכנת מיילים שיווקיים.', status: 'מתוכנן', link: 'https://trello.com/b/marketing_tasks' },
            { month: 'ינואר 2026', person: 'נתנאל', task: 'שיפור ביצועי טעינת הממשק ב-30%.', status: 'מתוכנן' },
            
            // --- פברואר 2026 ---
            { month: 'פברואר 2026', person: 'אלירן', task: 'הכנה לגרסת בטא פנימית - סיכום ואישור סופי.', status: 'מתוכנן' },
        ];
        
        // מיפוי צבעים לאנשים עבור כרטיסיות המשימה
        const personColorMap = {
            'אלירן': 'person-marker-eliran',
            'אבירם': 'person-marker-aviram',
            'אלכס': 'person-marker-alex',
            'דוד': 'person-marker-david',
            'ורד': 'person-marker-vered',
            'נתנאל': 'person-marker-netanel',
        };

        // מיפוי צבעים לסטטוס
        const statusColorMap = {
            'מתוכנן': 'bg-gray-400',
            'בעבודה': 'bg-yellow-500',
            'הושלם': 'bg-primary-color',
        };
        
        const filterSelect = document.getElementById('person-filter');
        const timelineOutput = document.getElementById('timeline-output');
        const noDataMessage = document.getElementById('no-data-message');

        // 1. טעינת אפשרויות הסינון
        function loadFilters() {
            let optionsHtml = `<option value="all">כל הצוות</option>`;
            people.forEach(person => {
                optionsHtml += `<option value="${person}">${person}</option>`;
            });
            filterSelect.innerHTML = optionsHtml;
            filterSelect.addEventListener('change', renderTimeline);
        }

        // 2. פונקציית טוגל פשוטה שמופעלת דרך הרינדור מחדש
        function handleToggle(event) {
            const monthId = event.target.dataset.monthId;
            const container = document.getElementById(`tasks-${monthId}`);
            const button = event.target;
            
            // טוגל המחלקה 'expanded'
            container.classList.toggle('expanded');
            
            // עדכון טקסט הכפתור
            if (container.classList.contains('expanded')) {
                button.textContent = 'הצג פחות';
            } else {
                button.textContent = 'הצג עוד';
            }
        }

        // 3. הגדרת מאזיני אירועים לכפתורים (חייב לקרות אחרי כל רינדור)
        function setupToggleEvents() {
            document.querySelectorAll('.toggle-tasks-btn').forEach(button => {
                // הסרה קודם כל כדי למנוע כפילויות
                button.removeEventListener('click', handleToggle); 
                // הוספת המאזין
                button.addEventListener('click', handleToggle);
            });
        }

        /**
         * 4. פונקציה לבניית ורינדור ציר הזמן
         */
        function renderTimeline() {
            const selectedPerson = filterSelect.value;
            
            const filteredData = selectedPerson === 'all'
                ? timelineData
                : timelineData.filter(item => item.person === selectedPerson);

            // קיבוץ המשימות לפי חודש ושמירה על סדר (החודשים מופיעים כפי שהם בדאטא)
            const groupedByMonth = filteredData.reduce((acc, item) => {
                const month = item.month;
                if (!acc[month]) {
                    acc[month] = [];
                }
                acc[month].push(item);
                return acc;
            }, {});

            let timelineHtml = '';

            if (filteredData.length === 0) {
                timelineOutput.innerHTML = '';
                noDataMessage.classList.remove('hidden');
                return;
            } else {
                noDataMessage.classList.add('hidden');
            }

            const months = Object.keys(groupedByMonth);
            
            months.forEach((month) => {
                const tasks = groupedByMonth[month];
                const monthId = month.replace(/\s/g, '_'); // יצירת ID ייחודי ל-DOM
                const isOverflow = tasks.length > INITIAL_TASKS_DISPLAY;
                
                // --- כותרת חודש (נקודת ציון על הציר) ---
                timelineHtml += `
                    <div class="relative mb-12">
                        <!-- סמן החודש (העיגול על הקו) -->
                        <div class="timeline-item-marker shadow-md"></div>
                        
                        <!-- כרטיס החודש עצמו -->
                        <div class="timeline-content bg-white p-4 rounded-xl shadow-lg border border-primary-color/50 transform hover:shadow-xl transition duration-300">
                            <h2 class="text-xl font-bold text-primary-color mb-3 border-b pb-2">${month}</h2>
                            
                            <!-- קונטיינר המשימות הניתן לצמצום -->
                            <!-- הפעלת "expanded" אם אין גלישה מלכתחילה כדי לאפשר הצגה תקינה -->
                            <div id="tasks-${monthId}" class="tasks-container ${isOverflow ? '' : 'expanded'}"> 
                                <ul class="space-y-4 pt-2">
                `;
                
                // --- רשימת המשימות בתוך החודש ---
                tasks.forEach(task => {
                    const personMarkerClass = personColorMap[task.person] || 'bg-gray-500';
                    const statusClass = statusColorMap[task.status] || 'bg-gray-400';
                    
                    // כפתור הקישור - מופיע רק אם קיים קישור
                    const linkButton = task.link ? `
                        <a href="${task.link}" target="_blank" class="flex items-center text-xs font-semibold text-primary-color hover:text-blue-700 transition duration-150 border border-primary-color/50 rounded-full px-3 py-1 mr-auto shadow-sm hover:bg-blue-50">
                            <!-- SVG של קישור -->
                            <svg class="w-3 h-3 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                            קישור
                        </a>
                    ` : '';
                    
                    timelineHtml += `
                        <li class="p-3 bg-secondary-gray rounded-lg border border-gray-200 flex items-start space-x-3 space-x-reverse">
                            <!-- סמן האדם -->
                            <div class="w-2 h-2 rounded-full mt-2 flex-shrink-0 ${personMarkerClass}"></div>
                            
                            <div class="flex-grow">
                                <p class="text-base font-semibold text-gray-800">${task.task}</p>
                                <div class="flex items-center mt-2 space-x-3 space-x-reverse text-xs text-gray-600">
                                    <span class="flex items-center">
                                        <!-- אייקון אדם -->
                                        <svg class="w-4 h-4 ml-1 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                        <span class="font-bold">${task.person}</span>
                                    </span>
                                    
                                    <span class="flex items-center">
                                        <span class="w-2 h-2 rounded-full ml-1 ${statusClass}"></span>
                                        <span>${task.status}</span>
                                    </span>
                                    
                                    ${linkButton}
                                </div>
                            </div>
                        </li>
                    `;
                });
                
                timelineHtml += `
                                </ul>
                            </div>
                `;
                
                // כפתור הצג עוד/פחות - מופיע רק אם יש גלישה
                if (isOverflow) {
                    timelineHtml += `
                        <div class="text-center mt-4">
                            <button class="toggle-tasks-btn text-sm font-semibold text-primary-color hover:text-blue-700 transition duration-150 py-1 px-4 rounded-full border border-primary-color/50 hover:bg-blue-50 shadow-sm" data-month-id="${monthId}">
                                הצג עוד
                            </button>
                        </div>
                    `;
                }
                
                timelineHtml += `
                        </div>
                    </div>
                `;
            });

            timelineOutput.innerHTML = timelineHtml;
            setupToggleEvents(); // קריאה להגדרת המאזינים לכפתורים החדשים
        }

        // 5. אתחול
        window.onload = function() {
            loadFilters();
            renderTimeline(); // רינדור ראשוני
        };
        
    </script>
</body>
</html>